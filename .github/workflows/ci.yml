name: Python Accounting App CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
      # 第一步：检出你的代码库
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # 第二步：设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      # 第三步：安装项目依赖
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # 假设你的依赖项在 requirements.txt 中
          # pip install -r requirements.txt  
          pip install pytest pytest-cov
      
      # 第四步：运行单元测试
      - name: Run tests with pytest
        run: |
          # 创建测试文件
          cat > test_accounting.py << 'EOF'
from main import Record, Tag

def test_record_creation():
    record = Record(True, 1000, Tag.SALARY, "2024-01-01 12:00", "")
    assert record.number == 1000
    assert record.in_or_out == True
    assert record.tag == Tag.SALARY
    print("✅ Record creation test passed")

def test_record_display():
    record = Record(False, 500, Tag.FOOD, "2024-01-01 12:00", "")
    display_text = record.get_display_text()
    assert "支出" in display_text
    assert "500元" in display_text
    print("✅ Record display test passed")

if __name__ == "__main__":
    test_record_creation()
    test_record_display()
EOF
          
          # 运行测试
          python -m pytest test_accounting.py -v