# 4. 创建测试专用的主文件（避免PyQt5 GUI问题）
- name: Create test version
  run: |
    # 备份原始文件
    cp main.py main_original.py
    
    # 使用最简单的echo方式创建文件
    rm -f main.py
    echo 'from enum import Enum' >> main.py
    echo 'from datetime import datetime' >> main.py
    echo '' >> main.py
    echo 'class Tag(Enum):' >> main.py
    echo '    SALARY = "工资"' >> main.py
    echo '    AWARD = "奖金"' >> main.py
    echo '    FOOD = "食物"' >> main.py
    echo '    CLOTHES = "衣物"' >> main.py
    echo '    HOUSE = "住房"' >> main.py
    echo '    TRAFFIC = "交通"' >> main.py
    echo '    CUSTOM = "自定义标签"' >> main.py
    echo '' >> main.py
    echo 'class Record:' >> main.py
    echo '    def __init__(self, in_or_out, number, tag, time=None, custom_tag=""):' >> main.py
    echo '        self.in_or_out = in_or_out' >> main.py
    echo '        self.number = number' >> main.py
    echo '        self.time = time if time else datetime.now().strftime("%Y-%m-%d %H:%M")' >> main.py
    echo '        self.tag = tag' >> main.py
    echo '        self.custom_tag = custom_tag' >> main.py
    echo '' >> main.py
    echo '    def get_display_text(self):' >> main.py
    echo '        direction = "收入" if self.in_or_out else "支出"' >> main.py
    echo '        tag_display = self.custom_tag if self.tag == Tag.CUSTOM and self.custom_tag else self.tag.value' >> main.py
    echo '        return f"{self.time:<16} {direction:>4} {int(self.number):>6}元 {tag_display:>8}"' >> main.py
    echo '' >> main.py
    echo 'class MockAccountingApp:' >> main.py
    echo '    def __init__(self):' >> main.py
    echo '        self.records = []' >> main.py