name: Python Accounting App CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install pytest
      
      - name: Check file structure
        run: |
          echo "ğŸ“ å½“å‰ç›®å½•ç»“æ„:"
          ls -la
          echo ""
          if [ -f "main.py" ]; then
            echo "âœ… main.py å­˜åœ¨"
          else
            echo "âŒ main.py ä¸å­˜åœ¨"
          fi
      
      - name: Run basic Python tests
        run: |
          python -c "
print('ğŸ”§ å¼€å§‹åŸºç¡€æµ‹è¯•...')
x = 1 + 1
assert x == 2
print('âœ… åŸºç¡€æ•°å­¦è¿ç®—é€šè¿‡')

import sys
import os
sys.path.insert(0, os.getcwd())

if os.path.exists('main.py'):
    with open('main.py', 'r') as f:
        content = f.read()
    
    # ç¼–è¯‘æ£€æŸ¥è¯­æ³•
    compile(content, 'main.py', 'exec')
    print('âœ… main.py è¯­æ³•æ£€æŸ¥é€šè¿‡')
else:
    print('âš ï¸  main.py ä¸å­˜åœ¨ï¼Œè·³è¿‡è¯­æ³•æ£€æŸ¥')

print('ğŸ‰ æ‰€æœ‰åŸºç¡€æµ‹è¯•é€šè¿‡ï¼')
          "
      
      - name: Create test directory
        run: |
          mkdir -p tests
      
      - name: Create simple test file
        run: |
          cat > tests/test_basic.py << 'EOF'
def test_placeholder():
    """å ä½æµ‹è¯•ï¼Œç¡®ä¿æµ‹è¯•æ¡†æ¶å·¥ä½œ"""
    assert 1 + 1 == 2

def test_main_exists():
    """æ£€æŸ¥main.pyæ˜¯å¦å­˜åœ¨"""
    import os
    assert os.path.exists("main.py")
EOF
      
      - name: Run pytest
        run: |
          python -m pytest tests/ -v